<!-- resume/templates/resume/resume.html -->
{% load bootstrap4 %}
<!DOCTYPE html>
<html>
<head>
    <title>Резюме</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        .resume-section {
            margin-bottom: 20px;
        }
        .resume-section h2 {
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .resume-section p {
            white-space: pre-line;
        }
        .highlight-date {
            color: red; /* Измените цвет на нужный вам */
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Резюме</h1>
    {% if resume %}
        <div class="row">
            <div class="col-md-4">
                <img src="{{ resume.photo.url }}" class="img-fluid" alt="Фото" style="max-width: 100%;">
            </div>
            <div class="col-md-8">
                <div class="resume-section">
                    <h2>Дополнительная информация</h2>
                    <p>{{ resume.additional_info|linebreaksbr|urlize|safe }}</p>
                </div>
            </div>
        </div>
        <div class="resume-section">
            <h2>Желаемая должность</h2>
            <p>{{ resume.desired_position|linebreaksbr|urlize|safe }}</p>
        </div>
        <div class="resume-section">
            <h2>Образование</h2>
            <p>{{ resume.education|linebreaksbr|urlize|safe }}</p>
            {% if resume.education_files.all %}
                <h3>Аттестаты:</h3>
                <ul>
                    {% for file in resume.education_files.all %}
                        <li><a href="{{ file.file.url }}" download target="_blank">{{ file.file.name }}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
        <div class="resume-section">
            <h2>Опыт работы</h2>
            <p>{{ resume.work_experience|linebreaksbr|urlize|safe }}</p>
        </div>
        <div class="resume-section">
            <h2>О себе</h2>
            <p>{{ resume.about_me|linebreaksbr|urlize|safe }}</p>
        </div>
        <div class="resume-section">
            <h2>Контакты</h2>
            <p id="contact-info">{{ resume.contacts|linebreaksbr|urlize|safe }}</p>
        </div>
    {% else %}
        <p>Резюме отсутствует.</p>
    {% endif %}
    <!-- Кнопка для вызова модального окна -->
    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#contactModal">
        Связаться со мной
    </button>
</div>

<!-- Модальное окно -->
<div class="modal fade" id="contactModal" tabindex="-1" role="dialog" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contactModalLabel">Контакты</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="modal-contact-info">{{ resume.contacts|linebreaksbr|urlize|safe }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script>
    // Функция для выделения дат и создания кликабельных ссылок для телефона и мессенджеров
    document.addEventListener("DOMContentLoaded", function() {
        const datePattern = /\b\d{1,2}\.\d{1,2}\.\d{2,4}\b/g;
        const phonePattern = /Телефон:\s*(\+\d $$\d{3}$$ \d{7})/g;

        document.querySelectorAll('.resume-section p').forEach(function(p) {
            // Выделение дат
            p.innerHTML = p.innerHTML.replace(datePattern, function(match) {
                return '<span class="highlight-date">' + match + '</span>';
            });

            // Создание кликабельных ссылок для телефона и мессенджеров
            p.innerHTML = p.innerHTML.replace(phonePattern, function(match, phone) {
                const phoneDigits = phone.replace(/\D/g, ''); // Удалить все нецифровые символы
                const contactInfo = `
                    Телефон: <a href="tel:${phoneDigits}">${phone}</a><br>
                    WhatsApp: <a href="https://wa.me/${phoneDigits}" target="_blank">WhatsApp</a><br>
                    Telegram: <a href="https://t.me/${phoneDigits}" target="_blank">Telegram</a><br>
                    Viber: <a href="viber://chat?number=%2B${phoneDigits}" target="_blank">Viber</a>
                `;
                document.getElementById('contact-info').innerHTML = contactInfo;
                document.getElementById('modal-contact-info').innerHTML = contactInfo;
                return `Телефон: <a href="tel:${phoneDigits}">${phone}</a>`;
            });

            // Сделать все ссылки открывающимися в новом окне
            p.querySelectorAll('a').forEach(function(a) {
                a.setAttribute('target', '_blank');
            });
        });
    });
</script>
</body>
</html>
