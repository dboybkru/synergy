{% extends "base.html" %}

{% block content %}
    <h1 class="mb-4">Админ панель</h1>
    <div class="row">
        <div class="col-md-6">
            <h2>Редактировать резюме</h2>
            <form method="POST" enctype="multipart/form-data">
                {{ form.hidden_tag() }}
                <div class="form-group">
                    {{ form.photo.label }}
                    {{ form.photo(class="form-control-file", id="photo-upload") }}
                    <img id="photo-preview" src="#" alt="Предпросмотр фото" style="max-width: 200px; display: none;">
                </div>
                <div class="form-group">
                    {{ form.about.label }}
                    {{ form.about(class="form-control summernote", rows=5) }}
                </div>
                <div class="form-group">
                    {{ form.education.label }}
                    {{ form.education(class="form-control summernote", rows=5) }}
                </div>
                <div class="form-group">
                    {{ form.experience.label }}
                    {{ form.experience(class="form-control summernote", rows=5) }}
                </div>
                <div class="form-group">
                    {{ form.desired_position.label }}
                    {{ form.desired_position(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ form.additional_info.label }}
                    {{ form.additional_info(class="form-control summernote", rows=5) }}
                </div>
                <div class="form-group">
                    {{ form.contacts.label
                    </div>
                    <div class="form-group">
                        {{ form.contacts.label }}
                        {{ form.contacts(class="form-control summernote", rows=3) }}
                    </div>
                    <div class="form-group">
                        {{ form.block_order.label }}
                        {{ form.block_order(class="form-control", id="block_order") }}
                    </div>
                    <div id="block-order-list" class="mb-3">
                        <div class="card mb-2" data-id="about">О себе</div>
                        <div class="card mb-2" data-id="education">Образование</div>
                        <div class="card mb-2" data-id="experience">Опыт работы</div>
                        <div class="card mb-2" data-id="desired_position">Желаемая должность</div>
                        <div class="card mb-2" data-id="additional_info">Дополнительная информация</div>
                        <div class="card mb-2" data-id="contacts">Контакты</div>
                    </div>
                    <div class="form-group">
                        {{ form.color_scheme.label }}
                        {{ form.color_scheme(class="form-control") }}
                    </div>
                    {{ form.submit(class="btn btn-primary") }}
                </form>
            </div>
            <div class="col-md-6">
                <h2>Управление файлами</h2>
                <form method="POST" action="{{ url_for('upload_pdf') }}" enctype="multipart/form-data" class="mb-4">
                    <div class="form-group">
                        <label for="file">Загрузить PDF</label>
                        <input type="file" name="file" id="file" class="form-control-file">
                    </div>
                    <button type="submit" class="btn btn-secondary">Загрузить</button>
                </form>
                
                <h3>Загруженные файлы</h3>
                <ul class="list-group">
                {% for file in files %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <a href="{{ url_for('download_file', filename=file) }}">{{ file }}</a>
                        <button class="btn btn-danger btn-sm" onclick="confirmDelete('{{ file }}')">Удалить</button>
                    </li>
                {% endfor %}
                </ul>
            </div>
        </div>
    {% endblock %}
    
    {% block styles %}
        {{ super() }}
        <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
        <style>
            #block-order-list .card {
                cursor: move;
                padding: 10px;
            }
        </style>
    {% endblock %}
    
    {% block scripts %}
        {{ super() }}
        <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.13.0/Sortable.min.js"></script>
        <script>
            $(document).ready(function() {
                $('.summernote').summernote({
                    height: 200,
                    toolbar: [
                        ['style', ['bold', 'italic', 'underline', 'clear']],
                        ['font', ['strikethrough', 'superscript', 'subscript']],
                        ['para', ['ul', 'ol', 'paragraph']],
                        ['height', ['height']]
                    ]
                });
    
                function readURL(input) {
                    if (input.files && input.files[0]) {
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            $('#photo-preview').attr('src', e.target.result);
                            $('#photo-preview').show();
                        }
                        reader.readAsDataURL(input.files[0]);
                    }
                }
    
                $("#photo-upload").change(function() {
                    readURL(this);
                });
    
                var el = document.getElementById('block-order-list');
                var sortable = Sortable.create(el, {
                    animation: 150,
                    onEnd: function () {
                        var order = sortable.toArray();
                        $('#block_order').val(order.join(','));
                    }
                });
    
                // Initialize block order
                var initialOrder = $('#block_order').val().split(',');
                initialOrder.forEach(function(id) {
                    var element = el.querySelector('[data-id="' + id + '"]');
                    if (element) {
                        el.appendChild(element);
                    }
                });
            });
    
            function confirmDelete(filename) {
                if (confirm('Вы уверены, что хотите удалить файл ' + filename + '?')) {
                    window.location.href = "{{ url_for('delete_file', filename='') }}" + filename;
                }
            }
        </script>
    {% endblock %}
    

